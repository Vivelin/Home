var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),LoadingIndicator=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.render=function(){return React.createElement("div",{className:"loader",hidden:!this.props.visible})},t}(React.Component),TwitchStream=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.SortByViewersDescending=function(n,t){return t.viewer_count-n.viewer_count},t.IsLive=function(n){return n.type!="vodcast"},t.prototype.render=function(){if(!this.props.user)return null;var n="https://www.twitch.tv/"+this.props.user.login,t=this.props.stream.thumbnail_url.replace("{width}","640").replace("{height}","360")+"#"+Date.now();return React.createElement("figure",{className:"twitchStream"},React.createElement("a",{href:n,target:"_blank",rel:"external"},React.createElement("img",{src:t,alt:this.props.stream.title,className:"twitchStream-thumbnail"})),React.createElement("figcaption",null,React.createElement("a",{href:n,target:"_blank",rel:"external"},React.createElement("img",{src:this.props.user.profile_image_url,alt:this.props.user.display_name,title:this.props.user.display_name,className:"twitchStream-profileImage"}),React.createElement("b",{className:"twitchStream-title",title:this.props.stream.title},this.props.stream.title),React.createElement("span",{className:"twitchStream-description"},this.description()))))},t.prototype.description=function(){var n=this.props.stream.viewer_count;return n===0?this.uptime()+" by themselves":n===1?this.uptime()+" for a lone soul":this.uptime()+" with "+n.toLocaleString()+" viewers"},t.prototype.uptime=function(){var t=6e4,i=60*t,r=24*i,o=new Date(this.props.stream.started_at),n=Date.now()-o.getTime(),u,f,e;return n<15*t?"Going live":n<1.5*i?(u=n/t,Math.round(u)+"m"):n<1.5*r?(f=n/i,Math.round(f)+"h"):(e=n/r,"~"+Math.round(e)+"d")},t}(React.Component),TwitchFollows=function(n){function t(t){var i=n.call(this,t)||this;return i.state={pendingRequests:0,reloadIntervalId:null,user:null,streams:null,streamsUsers:null,errorName:null,errorMessage:null},i}return __extends(t,n),t.prototype.componentDidMount=function(){var t=this,n;this.fetchUser();this.fetchStreams();n=window.setInterval(function(){return t.fetchStreams()},this.props.reloadInterval);this.setState({reloadIntervalId:n})},t.prototype.componentWillUnmount=function(){window.clearInterval(this.state.reloadIntervalId)},t.prototype.render=function(){var t=this,n=!this.state.user||!this.state.streams||!this.state.streamsUsers;return n&&this.state.errorName?this.state.errorName==="Unauthorized"?null:React.createElement("p",null,this.state.errorName,": ",this.state.errorMessage):React.createElement(React.Fragment,null,React.createElement(LoadingIndicator,{visible:this.state.pendingRequests>0}),!n&&this.state.streams.sort(TwitchStream.SortByViewersDescending).filter(TwitchStream.IsLive).map(function(n,i){var r=t.state.streamsUsers.filter(function(t){return t.id===n.user_id})[0];return React.createElement(TwitchStream,{key:i,user:r,stream:n})}))},t.prototype.fetchUser=function(){var n=this;this.sendRequest("users?id="+this.props.userId,function(t){n.setState({user:t.data[0]})})},t.prototype.fetchStreams=function(){var n=this;this.sendRequest("users/follows?from_id="+this.props.userId,function(t){return n.loadStreams(t)})},t.prototype.loadStreams=function(n){var t=this,i,r;n.data.length!=0&&(i="streams?user_id="+n.data.map(function(n){return n.to_id}).join("&user_id="),this.sendRequest(i,function(n){t.setState(function(i){return{streams:t.merge(i.streams,n.data,function(n){return n.id})}})}),r="users?id="+n.data.map(function(n){return n.to_id}).join("&id="),this.sendRequest(r,function(n){t.setState(function(i){return{streamsUsers:t.merge(i.streamsUsers,n.data,function(n){return n.id})}})}),n.pagination&&this.sendRequest("users/follows?from_id="+this.props.userId+"&after="+n.pagination.cursor,function(n){return t.loadStreams(n)}))},t.prototype.sendRequest=function(n,t){var r=this,i=new XMLHttpRequest;i.onload=function(){r.setState(function(n){return{pendingRequests:n.pendingRequests-1}});var n=JSON.parse(i.responseText);n.error?r.setState({errorName:n.error,errorMessage:n.message}):t(n)};i.open("GET","https://api.twitch.tv/helix/"+n);i.setRequestHeader("Authorization","Bearer "+this.props.accessToken);this.setState(function(n){return{pendingRequests:n.pendingRequests+1}});i.send()},t.prototype.merge=function(n,t,i){return n?n.filter(function(n){return!t.some(function(t){return i(t)===i(n)})}).concat(t):t},t}(React.Component),container=document.getElementById("twitch-follows"),userId,accessToken;container&&(userId=container.dataset.userId,accessToken=container.dataset.accessToken,ReactDOM.render(React.createElement(TwitchFollows,{reloadInterval:3e4,userId:userId,accessToken:accessToken}),container));
//# sourceMappingURL=index.min.js.map