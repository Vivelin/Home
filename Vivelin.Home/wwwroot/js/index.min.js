var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TwitchStream=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.render=function(){if(!this.props.user||!this.props.game)return null;var n="https://www.twitch.tv/"+this.props.user.login,t=this.props.stream.thumbnail_url.replace("{width}","640").replace("{height}","360");return React.createElement("figure",{className:"twitchStream"},React.createElement("a",{href:n,target:"_blank",rel:"external"},React.createElement("img",{src:t,alt:this.props.stream.title,className:"twitchStream-thumbnail"})),React.createElement("figcaption",null,React.createElement("a",{href:n,target:"_blank",rel:"external"},React.createElement("img",{src:this.props.user.profile_image_url,alt:this.props.user.display_name,title:this.props.user.display_name,className:"twitchStream-profileImage"}),React.createElement("b",{className:"twitchStream-title",title:this.props.stream.title},this.props.stream.title),React.createElement("span",{className:"twitchStream-description"},this.props.user.display_name," // ",this.props.game.name))))},t}(React.Component),TwitchFollows=function(n){function t(t){var i=n.call(this,t)||this;return i.state={user:null,streams:null,streamsUsers:null,games:null,errorName:null,errorMessage:null},i}return __extends(t,n),t.prototype.componentDidMount=function(){this.fetchUser();this.fetchStreams()},t.prototype.render=function(){var n=this,t=!this.state.user||!this.state.streams||!this.state.streamsUsers||!this.state.games;return t&&!this.state.errorMessage?React.createElement("p",null,"Loading dataâ€¦"):t?this.state.errorName==="Unauthorized"?null:React.createElement("p",null,this.state.errorName,": ",this.state.errorMessage):this.state.streams.map(function(t,i){var r=n.state.streamsUsers.filter(function(n){return n.id===t.user_id})[0],u=n.state.games.filter(function(n){return n.id===t.game_id})[0];return React.createElement(TwitchStream,{key:i,user:r,stream:t,game:u})})},t.prototype.fetchUser=function(){var n=this;this.sendRequest("users?id="+this.props.userId,function(t){n.setState({user:t.data[0]})})},t.prototype.fetchStreams=function(){var n=this;this.sendRequest("users/follows?from_id="+this.props.userId,function(t){return n.loadStreams(t)})},t.prototype.loadStreams=function(n){var t=this,i,r;n.data.length!=0&&(i="streams?user_id="+n.data.map(function(n){return n.to_id}).join("&user_id="),this.sendRequest(i,function(n){t.setState(function(t){return{streams:t.streams?t.streams.concat(n.data):n.data}});var i="games?id="+n.data.map(function(n){return n.game_id}).join("&id=");t.sendRequest(i,function(n){t.setState(function(t){return{games:t.games?t.games.concat(n.data):n.data}})})}),r="users?id="+n.data.map(function(n){return n.to_id}).join("&id="),this.sendRequest(r,function(n){t.setState(function(t){return{streamsUsers:t.streamsUsers?t.streamsUsers.concat(n.data):n.data}})}),n.pagination&&this.sendRequest("users/follows?from_id="+this.props.userId+"&after="+n.pagination.cursor,function(n){return t.loadStreams(n)}))},t.prototype.sendRequest=function(n,t){var r=this,i=new XMLHttpRequest;i.onload=function(){var n=JSON.parse(i.responseText);n.error?r.setState({errorName:n.error,errorMessage:n.message}):t(n)};i.open("GET","https://api.twitch.tv/helix/"+n);i.setRequestHeader("Authorization","Bearer "+this.props.accessToken);i.send()},t}(React.Component),container=document.getElementById("twitch-follows"),userId,accessToken;container&&(userId=container.dataset.userId,accessToken=container.dataset.accessToken,ReactDOM.render(React.createElement(TwitchFollows,{userId:userId,accessToken:accessToken}),container));
//# sourceMappingURL=index.min.js.map